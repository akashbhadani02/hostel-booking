<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SPSS Hostel Dashboard By AB</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 20px;
  }

  h1 {
    text-align: center;
    margin-bottom: 10px;
  }

  .controls {
    max-width: 1000px;
    margin: 10px auto;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }

  select, input {
    padding: 8px;
    font-size: 14px;
  }

  .stats {
    max-width: 1000px;
    margin: 10px auto;
    display: flex;
    justify-content: space-around;
    font-weight: bold;
  }

  .rooms {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 10px;
    max-width: 1000px;
    margin: auto;
  }

  .room-btn {
    padding: 15px 0;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    color: white;
  }

  .empty { background: #28a745; }
  .occupied { background: #dc3545; }
  .cleaning { background: #ffc107; color: black; }
  .maintenance { background: #007bff; }

.floor-section {
  margin-bottom: 30px;
}

.floor-title {
  font-size: 18px;
  font-weight: bold;
  margin: 15px 0 10px;
  color: #333;
}

.floor-rooms {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 10px;
}

/* ===== VIDEO GALLERY ===== */
.video-gallery-section {
  max-width: 1000px;
  margin: 40px auto;
}

.video-gallery-title {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 15px;
}

.video-gallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 15px;
}

.video-gallery video {
  width: 100%;
  border-radius: 8px;
  background: black;
}

.video-item {
  text-align: center;
}

.video-title {
  margin-top: 6px;
  font-size: 14px;
  font-weight: bold;
  color: #333;
}

</style>
</head>

<body>

<h1>ğŸ¨SPSS Hostel Room</h1>

<!-- CONTROLS -->
<div class="controls">
  <select id="floorFilter">
    <option value="">All Floors</option>
    <option value="1">1st Floor</option>
    <option value="2">2nd Floor</option>
    <option value="3">3rd Floor</option>
    <option value="4">4th Floor</option>
    <option value="5">5th Floor</option>
    <option value="6">6th Floor</option>
    <option value="7">7th Floor</option>
    <option value="8">8th Floor</option>
    <option value="9">9th Floor</option>
    <option value="10">10th Floor</option>
    <option value="11">11th Floor</option>
    <option value="12">12th Floor</option>
    <option value="13">13th Floor</option>
  </select>

  <input type="number" id="searchRoom" placeholder="Search room">
</div>

<!-- STATS -->
<div class="stats">
  <div>ğŸŸ¢ àª–àª¾àª²à«€: <span id="emptyCount">0</span></div>
  <div>ğŸ”´ àª†àªªà«‡àª²à«€: <span id="occupiedCount">0</span></div>
  <div>ğŸŸ¡ àª¸àª«àª¾àªˆ: <span id="cleaningCount">0</span></div>
  <div>ğŸ”µ àª•àª¾àª²à«‡ àª†àªªàªµàª¾àª¨à«€: <span id="maintenanceCount">0</span></div>
</div>

<!-- ROOMS -->
 <div class="controls">
  <input type="number" id="newRoom" placeholder="Enter room number">
  <button onclick="addRoom()">â• Add Room</button>

  <input type="number" id="deleteRoom" placeholder="Room to delete">
  <button onclick="deleteRoom()">âŒ Delete Room</button>
</div>

<!-- ===== VIDEO GALLERY SECTION ===== -->
<div class="video-gallery-section">
  <div class="video-gallery-title">ğŸ¥ Hostel Video Gallery</div>

  <div class="video-gallery">

    <div class="video-item">
      <video controls autoplay>
        <source src="/image_video/video/9 sharing.mp4" type="video/mp4">
      </video>
      <div class="video-title">9 Sharing</div>
    </div>

    <div class="video-item">
      <video controls>
        <source src="/image_video/video/twin.mp4" type="video/mp4">
      </video>
      <div class="video-title">Twin Sharing</div>
    </div>

  </div>
</div>


<div class="rooms" id="rooms"></div>

<script>
let allRooms = [];

async function loadRooms() {
  const res = await fetch('/api/rooms');
  allRooms = await res.json();
  renderRooms();
}

function renderRooms() {
  const container = document.getElementById('rooms');
  container.innerHTML = '';

  const floorFilter = document.getElementById('floorFilter').value;
  const search = document.getElementById('searchRoom').value;

  // ---- stats ----
  const stats = { empty:0, occupied:0, cleaning:0, maintenance:0 };
  allRooms.forEach(r => stats[r.status]++);
  emptyCount.innerText = stats.empty;
  occupiedCount.innerText = stats.occupied;
  cleaningCount.innerText = stats.cleaning;
  maintenanceCount.innerText = stats.maintenance;

  // ---- group rooms by floor ----
  const floors = {};

  allRooms.forEach(r => {
    const roomStr = String(r.room);
    const floor = roomStr.slice(0, roomStr.length - 2); // floor number

    if (floorFilter && floor !== floorFilter) return;
    if (search && !roomStr.includes(search)) return;

    if (!floors[floor]) floors[floor] = [];
    floors[floor].push(r);
  });

  // ---- render floors ----
  Object.keys(floors).sort((a,b)=>a-b).forEach(floor => {
    const section = document.createElement('div');
    section.className = 'floor-section';

    const title = document.createElement('div');
    title.className = 'floor-title';
    title.innerText = `Floor ${floor}`;

    const roomWrap = document.createElement('div');
    roomWrap.className = 'floor-rooms';

    floors[floor].forEach(r => {
      const btn = document.createElement('button');
      btn.className = `room-btn ${r.status}`;
      btn.innerText = r.room;
      btn.onclick = () => cycleStatus(r);
      roomWrap.appendChild(btn);
    });

    section.appendChild(title);
    section.appendChild(roomWrap);
    container.appendChild(section);
  });
}


async function cycleStatus(room) {
  const order = ['empty', 'occupied', 'cleaning', 'maintenance'];
  const next = order[(order.indexOf(room.status) + 1) % order.length];

  await fetch('/api/room/' + room.room, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ status: next })
  });

  loadRooms();
}

floorFilter.onchange = renderRooms;
searchRoom.oninput = renderRooms;

loadRooms();

async function addRoom() {
  const room = document.getElementById('newRoom').value;

  if (!room) {
    alert("Enter room number");
    return;
  }

  const res = await fetch('/api/add-room', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ room: Number(room) })
  });

  const data = await res.json();

  if (data.success) {
    document.getElementById('newRoom').value = '';
    loadRooms(); // refresh buttons
  } else {
    alert(data.message);
  }
}

async function deleteRoom() {
  const room = document.getElementById('deleteRoom').value;

  if (!room) {
    alert("Enter room number to delete");
    return;
  }

  if (!confirm(`Delete room ${room}?`)) return;

  const res = await fetch('/api/delete-room/' + room, {
    method: 'DELETE'
  });

  const data = await res.json();

  if (data.success) {
    document.getElementById('deleteRoom').value = '';
    loadRooms(); // refresh
  } else {
    alert(data.message);
  }
}

</script>
</body>
</html>
